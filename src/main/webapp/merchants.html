<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Merchant Detail</title>
    <link rel="stylesheet" href="/css/merchants.css">
    <script type="text/javascript">
      function fetchMerchant(id) {
        const url = '/add-merchant?id=' + id
        fetch(url).then((response) => {
          return response.json();
        }).then((merchant) => {
          
          const merchantName = document.getElementById('merchant-name');
          const nameNode = document.createTextNode(merchant.name);
          merchantName.appendChild(nameNode);

          const merchantContainer = document.getElementById('merchant-container');
          merchantContainer.innerHTML = '';

          const imgElement = buildImageElement(merchant.image);
          imgElement.classList.add("merchant-img");
          merchantContainer.appendChild(imgElement);

          const merchantDesc = buildMerchantDescription(merchant);
          merchantContainer.appendChild(merchantDesc)
        })
      }

      function buildImageElement(image){
        const imgElement = document.createElement('img');
        imgElement.setAttribute('src', image);
        
        return imgElement;
      }

      function buildMerchantDescription(merchant) {
        const merchantDesc = document.createElement('div');

        const locationEl = document.createElement('p');
        const locNode = document.createTextNode('Location: ' + merchant.location);
        locationEl.appendChild(locNode);
        merchantDesc.appendChild(locationEl);

        const cuisineEl = document.createElement('p');
        const cuisineNode = document.createTextNode('Cuisine: ' + merchant.cuisine);
        cuisineEl.appendChild(cuisineNode);
        merchantDesc.appendChild(cuisineEl)

        // const priceRangeEl = document.createElement('p');
        // priceRangeEl.innerHTML = 'Price range: ';
        // merchantDesc.appendChild(priceRangeEl)

        // const paymentEl = document.createElement('p');
        // paymentEl.innerHTML = 'Payment options: ' + merchant.payment;
        // merchantDesc.appendChild(paymentEl)

        return merchantDesc
      }

      function fetchMenus(merchantId) {
        const url = '/menus?merchantId=' + merchantId;
        fetch(url).then((response) => {
          return response.json();
        }).then((menus) => {
          const menuContainer = document.getElementById('menus');
          menuContainer.innerHTML = ''

          const linkEl = document.createElement('a');
          const node = document.createTextNode("Add new menu");
          linkEl.appendChild(node);
          linkEl.setAttribute('href', '/add-menu.html?merchantId'+ merchant.id)
          menuContainer.appendChild(linkEl)

          for(menu in menus) {
            const menuDiv = document.createElement('div');

            const H4 = document.createElement('h4');
            const h4Node = document.createTextNode(menu.name);
            H4.appendChild(h4Node);
            menuDiv.appendChild(H4)

            const imgElement = buildImageElement(menu.image);
            imgElement.classList.add("merchant-img");
            imgElement.appendChild(imgElement);

            const priceElement = document.createElement('p');
            const priceNode = document.createTextNode(menu.price);
            priceElement.appendChild(priceNode);
            menuDiv.appendChild(priceElement)

            const descElement = document.createElement('p');
            const descNode = document.createTextNode(menu.description);
            descElement.appendChild(descNode);
            menuDiv.appendChild(descElement)

            menuContainer.appendChild(menuDiv)
          }
        })
      }

      function buildUI() {
        const url_string = window.location.href;
        const url = new URL(url_string)
        fetchMerchant(url.searchParams.get('id'))
      }

    </script>
  </head>
  <body onload="buildUI()">
    <nav>
      <ul id="navigation">
        <li><a href="/">Home</a></li>
        <li><a href="/aboutus.html">About Our Team</a></li>
      </ul>
    </nav>

    <h2 id="merchant-name"></h2>
    <div id="merchant-container"></div>

    <div id="menus"></div>
  </body>
</html>